#Architecture #DDD #개발서적 

## 엔티티와 밸류
도출할 모델은 크게 엔티티(Entity)와 벨류(Value)로 구분할 수 있다.
엔티티와 벨류를 제대로 구분해야 도메인을 올바르게 설계하고 구현할 수 있다.

> [!example]+ 
> + Entity : Order
> + Value : ShippingInfo, OrderLine
> ![[entityvalue.png]]


## 엔티티([[Entity]])
일반적으로 생각하는(JPA에서의) Entity와 같다고 생각하면 된다. 엔티티의 가장 큰 특징으로 **식별자를 가진다**만 체크하고 넘어가자.

> [!important]+ 
> 모든 방식에서 똑같지만 Setter는 쓰지 말자!
## 밸류
밸류 타입은 개념적으로 완전한 하나를 표현할 때 사용한다. 의미를 명확하게 표현하기 위해 밸류 타입을 사용하는 경우도 있다. 또한 밸류 타입을 위한 기능을 추가할 수 있다는 장점도 있다.

> [!tip]+ 
> JPA로 생각하자면 [[값 타입]]에서의 임베디드 타입([[@Embedded]])과 비슷하다고 할 수 있다.

밸류 객체의 데이터를 변경할 때는 **기존 데이터를 변경하기보다는 변경한 데이터를 갖는 새로운 밸류 객체를 생성하는 방식을 선호**한다.

밸류 타입은 불변(immutable) 객체로 구현하는데, 이는 **보다 안전한 코드를 작성할 수 있다**는 장점이 있다. 만약 중간에 값을 변경할 수 있다면 참조 투명성과 관련된 문제가 생길 수 있다.

> [!info]+ 참조 투명성
> + 함수가 함수 외부의 영향을 받지 않는 것을 의미한다.
> 
> ![[value.png]]

> [!tip]+ 
> 두 밸류 객체를 비교할 때는 모든 속성이 같은지 비교한다.


### 엔티티 식별자와 밸류 타입
식별자는 단순한 문자열이 아니라 도메인에서 특별한 의미를 지니는 경우가 많기 때문에 식별자를 위한 밸류 타입을 사용하여 의미가 잘 드러나게 할 수 있다.

```java
public class Order{
	//OrderNo 타입 자체로 id가 주문번호임을 알 수 있다.
	private OrderNo id;
}
```

---

## 도메인 모델 엔티티 vs RDBMS 엔티티
**실제 도메인 모델의 엔티티와 DB 관계형 모델의 엔티티는 같은 것이 아니다.**
### 1. 기능 도메인 기능 제공
도메인 모델의 엔티티는 데이터와 함께 도메인 기능을 함께 제공한다. 단순히 데이터를 담고 있는 데이터 구조라기보다는 데이터와 함께 기능을 제공하는 객체이다.

> [!example]+ 
> 주문 엔티티는 주문과 관련된 데이터뿐만 아니라 배송지 주소 변경을 위한 기능도 함께 제공한다.
> 
```java
public class Order{  
    // 주문 도메인 모델의 데이터  
    private OrderNo number;  
    private Orderer orderer;  
    private ShippingInfo shippingInfo;  
    ...  
      
    // 도메인 모델 엔티티는 도메인 기능도 함께 제공  
    public void changeShippingInfo(ShippingInfo newShippingInfo) {  
        ...  
    }  
      
}
```

### 2. 밸류 타입의 표현
또 다른 차이점은 도메인 모델의 엔티티는 두 개 이상의 데이터가 개념적으로 하나인 경우, 밸류 타입을 이용하여 표현할 수 있다는 것이다.

```java
public class Orderer {
	private String name;
	private String email;
}
```

RDBMS와 같은 관계형 데이터베이스는 밸류 타입을 제대로 표현하기 힘들다. 별도의 테이블에 저장해도 이것은 엔티티에 가까우며 밸류 타입의 의미가 드러나지는 않는다.