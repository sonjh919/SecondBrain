#Architecture #DDD #개발서적 #jpa 


## Aggregate 로딩 전략
애그리거트는 개념적으로 하나여야 한다. 하지만, 루트 엔티티([[Aggregate 루트]])를 로딩하는 시점에 애그리거트에 속한 객체를 모두 로딩해야 하는 것은 아니다. 그 이유는 다음의 두 가지이다.

> [!summary]+ 
> + 상태를 변경하는 기능을 실행할 때 애그리거트 상태가 완전해야 한다
> + 표현 영역에서 애그리거트의 상태 정보를 보여줄 때 필요하다

JPA는 트랜잭션 범위 내에서 [[지연 로딩]]을 허용하기 때문에 실제로 상태를 변경하는 시점에 필요한 구성요소만 로딩해도 문제가 되지 않는다.

> [!note]+ 
> 결론 : 애그리거트에 맞게 즉시 로딩과 지연 로딩을 선택해야 한다.


## 애그리거트 [[영속성 전이]]
애그리거트는 완전한 상태여야 한다는 것은 조회할 때뿐만 아니라 저장하고 삭제할 때도 하나로 처리해야 함을 의미한다.

[[@Embeddable]] 타입은 함께 저장되고 삭제되므로 추가 설정이 필요없지만, 애그리거트에 속한 @Entity 타입에 대한 매핑은 cascade 속성을 사용해서 저장과 삭제 시에 함께 처리되도록 설정해야 한다.

> [!check]+ 
> @OneToOne, @OneToMany는 cascade 속성의 기본값이 없으므로 cascade 속성값으로 CascadeType.PERSIST, CascadeType.REMOVE를 설정한다.