#Architecture #DDD #Book

## 여러 애그리거트가 필요한 기능
도메인 영역의 코드를 작성하다 보면 한 애그리거트로 기능을 구현할 수 없을 때가 있다. 대표적인 예가 결제 금액 계산 로직이다. 실제 결제 금액을 계산할 때는 다음과 같은 내용이 필요하다.

> [!summary]+ 
> + 상품 애그리거트 : 구매하는 상품의 가격이 필요하다. 또한 상품에 따라 배송비가 추가되기도 한다.
> + 주문 애그리거트 : 상품별로 구매 개수가 필요하다.
> + 할인 쿠폰 애그리거트 : 쿠폰별로 지정한 할인 금액이나 비율에 따라 주문 총금액을 할인한다.
> + 회원 애그리거트 : 회원 등급에 따라 추가 할인이 가능하다.

다음과 같은 상황에서 이러한 의문점이 생길 수 있다.

> [!summary]+ 
> + 이 상황에서 실제 결제 금액을 계산해야 하는 주체는 어떤 애그리거트일까?
> + 할인 금액을 구하는것은 누구 책임일까?
> + 할인 쿠폰이 할인 규칙을 갖고 있으니 할인 쿠폰 애그리거트가 계산해야 할까?

이렇게 **한 애그리거트에 넣기에 애매한 도메인 기능을 특정 애그리거트에서 억지로 구현하면 안 된다.** 이 경우 애그리거트는 자신의 책임 범위를 넘어서는 기능을 구현하기 때문에 코드가 길어지고 외부에 대한 의존이 높아지게 된다. 이는 코드를 복잡하게 만들어 수정을 어렵게 만드는 요인이 된다. 또한 **애그리거트의 범위를 넘어서는 도메인 개념이 애그리거트에 숨어들어 명시적으로 드러나지 않게 된다.**

이런 문제를 해소하는 가장 쉬운 방법이 하나 있는데 그것은 바로 **[[도메인 서비스]]를 별도로 구현**하는 것이다.