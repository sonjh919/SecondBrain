#jpa #NativeSQL


## 네이티브 SQL 특징
- 네이티브 SQL도 JPQL을 사용할 때와 마찬가지로 Query, TypedQuery를 반환한다. 따라서 JPQL API를 그대로 사용할 수 있다.(ex) 페이징 처리)
- 네이티브 SQL은 JPQL이 자동 생성하는 SQL을 수동으로 직접 정의하는 것. **JPA 제공 기능 대부분을 그대로 사용 가능하다.**
- 네이티브 SQL은 관리하기 쉽지 않고 자주 사용시 특정 데이터베이스에 종속적인 쿼리가 많아져 **이식성이 떨어진다.**

> [!tip]+ 사용 순서
> 1. 표준 JPQL 사용하기
> 2. 하이버네이트 같은 JPA 구현체가 제공하는 기능 사용
> 3. 마지막 방법으로 네이티브 SQL 사용하기!
> 4. 그것으로도 부족하면 MyBatis나 JdbcTemplate같은 SQL매퍼와 JPA 함께 사용하기

## 특정 데이터베이스에 종속적인 기능
[[JPQL]]은 표준 SQL이 지원하는 대부분의 문법과 SQL 함수들을 지원하지만 특정 데이터베이스에 종속적인 기능은 지원하지 않는다.

> [!example]+ 
> + 특정 데이터베이스만 지원하는 함수, 문법, SQL 쿼리 힌트
> + 인라인 뷰(from 절 [[SubQuery]]), [[집합 연산자]](UNION, INTERSECT)
> + 스토어드 프로시저

하지만 때로는 특정 데이터베이스에 종속적인 기능이 필요하다. JPA는 특정 데이터베이스에 종속적인 기능을 사용할 수 있는 다양한 방법을 열어두었다. 그리고 JPA 구현체들은 JPA 표준보다 더 다양한 기능을 지원한다.
### 특정 데이터베이스만 사용하는 함수
- JPQL에서 네이티브 SQL 함수 호출
- 하이버네이트는 [[데이터베이스 방언]]에 각 데이터베이스에 종속적인 함수들을 정의해두었다. 직접 호출할 함수를 정의할 수도 있다.

### 특정 데이터베이스만 지원하는 SQL 쿼리 힌트
+ 하이버네이트를 포함한 몇몇 JPA 구현체들이 지원한다.

### 인라인뷰, 집합연산자(UNION, INTERSECT)
+ 하이버네이트는 지원하지 않지만 일부 JPA 구현체들이 지원한다.

### 스토어 프로시저
+ JPQL에서 스토어드 프로시저를 호출할 수 있다.

### 특정 데이터베이스만 지원하는 문법
+ 오라클의 CONNECT BY처럼 특정 데이터베이스에 너무 종속적인 SQL 문법은 지원하지 않는다. 이때는 네이티브 SQL을 사용해야 한다.

## 네이티브 SQL
다양한 이유로 JPQL을 사용할 수 없을 때 JPA는 SQL을 직접 사용할 수 있는 기능을 제공하는데, 이것을 네이티브 SQL이라 한다. JPQL을 사용하면 JPA가 SQL을 생성하는데, 네이티브SQL은 이 SQL을 개발자가 직접 정의하는 것이다.

> [!tip]+ 
> 쉽게 말해, JPQL이 **자동 모드**라면 네이티브 SQL은 **수동 모드**이다.


> [!note]+ 네이티브 SQL vs JDBC API
> + 네이티브 SQL을 사용하면 엔티티를 조회할 수 있고 JPA가 지원하는 영속성 컨텍스트의 기능을 그대로 사용할 수 있다.
> + 반면에 JDBC API를 직접 사용하면 단순히 데이터의 나열을 조회할 뿐이다.

