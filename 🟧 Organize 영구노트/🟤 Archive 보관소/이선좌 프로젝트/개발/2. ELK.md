#개발 #Project #ELK 

## [[ELK Stack]] 도입 배경
처음에는 [[QueryDSL]]을 이용하여 검색 시스템을 개발하였다. 하지만, 일반적인 티케팅에서의 검색은 다른 검색과 비교하여 요구사항이 더 많았다.

> [!summary]+ 
> 1. 트래픽을 받아내기 위해 빠른 검색이 필요했다. 특히, 필터가 많아질수록 로직 구현에 대한 난이도가 높아지고 그만큼 검색 속도가 느려진다.
> 2. 보통의 사람들은 콘서트의 정확한 네이밍을 알지 못한다. 즉, LIKE나 contain 검색 만으로는 결과가 만족스럽지 못하다. 또한 콘서트명보다는 가수명으로 검색하는 경우도 많기 때문에 가수를 검색해도 그에 맞는 콘서트명이 도출되어야 한다.

### 1. 빠른 검색의 필요성
DB에서의 select 속도를 높이는 가장 보편적인 방법으로는 인덱스를 설정하는 방법이 있다. 하지만, Elasticsearch의 [[역색인]](Inverted index, 역인덱스)를 활용하면 훨씬 빠른 검색 결과를 도출해낼 수 있다는 장점이 있다.

RDB 구조에서 검색 결과를 출력하려면 여러 테이블을 join해야 한다. 또한 필터를 추가할 때 마다 join과 DB Connection이 증가하여 검색 시간과 자원에 대한 애로사항이 있었다. 특정시간에 트래픽이 몰리는 우리 프로젝트에서는 이를 보완하기 위해 정보를 조합하여 Document 형태로 저장할 수 있고, 방식을 사용하는 검색엔진인 Elasticsearch를 도입하였다.
### 2. 자동완성의 필요성
보통의 사람들은 콘서트의 정확한 네이밍을 알지 못한다. 그래서 검색어를 분석할 시스템이 필요하다.
Elasticsearch에서는 [[캐릭터 필터]], [[토크나이저]], [[토큰 필터]]를 조합하여 커스텀 [[애널라이저]]를 만들 수 있기 때문에 검색어를 토큰화하여 분석하는 것이 가능하다. 

커스텀 애널라이저 만들기 : [[3. Custom Analyzer]]

## 실제로 속도가 개선되었는가?
초당 200개부터 800개까지의 검색 API를 날렸을 때, Elasticsearch와 QueryDSL의 속도 차이를 측정해 보았다. 확실히 트래픽이 몰릴수록 ES는 역인덱스를 사용하기 때문에 속도는 크게 차이가 없지만, QueryDSL의 경우 여러 테이블을 join하기 때문에 점점 속도가 느려지는 것을 확인할 수 있다.

초당 200개의 평균 검색 응답속도를 312ms에서 30ms로 약 90%의 검색 속도를 개선하였다.

![[Pasted image 20240612191749.png]]