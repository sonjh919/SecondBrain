#Elasticsearch 

인덱스 매핑에 지정할 수 있는 설정들은 다음과 같다.
> [!summary]+ 
> 1. [[필드 타입]]
> 2. [[doc_values]]
> 3. [[fielddata]]
> 4. [[_source]]
> 5. [[index]]
> 6. [[enabled]]

## 계층 구조를 지원하는 타입
> [!summary]+ 
> Object : 필드 하위에 다른 필드를 여럿 포함하는 객체 데이터 담기 가능. 기본값이기 때문에 명시적으로 표현하지는 않는다. 내부적으로는 평탄화된 키-값 쌍으로 색인.
> nested: object 타입과 다르게 배열 내 각 객체를 독립적으로 취급

---

## 2. doc_values
ES의 검색은 **역색인을 기반으로 한 색인**을 이용한다. 텀을 보고 역색인에서 문서를 찾는 방식이다. 하지만 정렬, 집계, 스크립트 작업 시에는 접근법이 다르다. 문서를 보고 필드 내의 텀을 찾는데, 이때 doc_values는 디스크를 기반으로 한 자료 구조로 파일 시스템 캐시를 통해 효율적으로 작업을 수행할 수 있게 설계되었다.

ES에서는 text와 annotated_text를 제외한 거의 모든 필드 타입이 doc_values를 지원하고, 필요 없는 필드는 끌 수도 있다.

## 3. fielddate
text 타입은 파일 시스템 기반의 캐시인 doc_values를 사용할 수 없기 때문에 text를 대상으로 정렬, 집계, 스크립트 작업 시 fielddate라는 캐시를 이용한다.

> [!warning]+ 
> 신중하게 활성화하기!

## 4. \_source
문서 색인 시점에 ES에 전달된 원본 JSON 문서를 저장하는 데이터 필드이다. 문서 조회 API나 검색 API가 클라이언트에게 반환할 문서를 확정하고 나면 이 \_source에 저장된 값을 읽어 클라이언트에게 반환한다. 필드 자체는 역색인을 생성하지 않기 때문에 검색 대상이 되지 않는다.

> [!note]+ 
> 1. JSON 문서를 통째로 담기 때문에 디스크를 많이 사용할 수 있다. 이를 막기 위해 enabled를 false로 할 수 있다.
> 2. ES의 세그먼트는 불변이기 대문에 비활성화하면 update를 할 수 없다. 또한 reindex도 마찬가지이다.

비활성화보다는 인덱스 코덱 변경, 8.4부터 나온 synthetic source(변경 여지 많음)을 사용하자.

## 5. index
해당 필드의 역색인을 만들 것인지를 지정한다. 기본값은 true이다. false로 설정하면 해당 필드는 역색인이 없기 때문에 일반적인 검색 대상이 되지 않는다. 하지만 다른 필드를 대상으로 한 검색 쿼리에 문서가 검색된다면 index가 false여도 검색 결과에 포함된다. 문서 내용 자체는 역색인 생성 여부와 상관없이 \_source라는 메타 필드에 저장되기 때문이다.

또한 역색인을 생성하지 않는 것뿐이기 때문에 doc_values를 사용하는 타입의 필드라면 정렬이나 집계의 대상으로는 사용할 수 있다.

엄밀히는 8.1부터는 index가 false여도 필드가 doc_values를 사용한다면 검색이 된다. 다만 성능이 떨어질 뿐이다.

## 6. enabled
object 타입의 필드에만 적용된다. false로 지정 시 역색인이나 doc_values를 생성하지 않고, 파싱도 하지 않으므로 성능상 이득이 있을 수 있다. 서비스 설계상 최종적으로 데이터를 \_source에서 확인만 하면 되고 그 외 어떠한 활용도 필요치 않은 필드가 있다면 고려해 볼 수 있다.