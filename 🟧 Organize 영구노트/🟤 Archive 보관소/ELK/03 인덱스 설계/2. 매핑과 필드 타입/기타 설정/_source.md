#Elasticsearch 

## \_source
\_source 필드는 문서 색인 시점에 ES에 전달된 **원본 JSON 문서를 저장하는 메타데이터 필드**이다. 문서 조회 API나 검색 API가 클라이언트에 반환할 문서를 확정하고 나면 이 \_source에 저장된 값을 읽어 클라이언트에게 반환한다.

> [!tip]+ 
> _source 필드 자체는 역색인을 생성하지 않기 때문에 **검색 대상이 되지 않는다.**

### \_source 비활성화
\_source 필드는 JSON 문서를 통째로 담기 때문에 디스크를 많이 사용한다. \_source에 데이터를 저장하지 않도록 mappings에 설정할 수도 있다.
```json
PUT no_source_test
{
	"mappings": {
		"_source": {
			"enabled": false
		}
	}
}
```

하지만 비활성화하면 많은 문제가 생길 수 있다.

> [!summary]+ 
> 1. 업데이트와 update_by_query API를 이용할 수 없다.
> 2. reindex API도 사용할 수 없다.

1. 업데이트 작업은 기존 문서를 변경하는 것이 아니라 기존 문서를 삭제하고 업데이트된 새 문서를 색인하는 작업이다. 이 과정에서 기존 문서의 내용을 확인해야 하는데 기존 문서의 내용을 읽어들일 \_source가 없기 때문이다.
2. reindex는 원본 인덱스에서 내용을 대상 인덱스에 새로 색인하는 작업이다. 이 때 \_source의 원본 JSON 데이터를 읽어 재색인 작업을 수행한다.

### 인덱스 코덱 변경
만약 다른 성능을 희생하더라고 디스크 공간을 절약해야 하는 상황이라면 \_source의 비활성화보다는 차라리 코덱을 변경하여 인덱스 데이터의 압축률을 높이자.