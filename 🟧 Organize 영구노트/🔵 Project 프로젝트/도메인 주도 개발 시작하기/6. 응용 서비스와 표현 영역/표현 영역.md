#Architecture #DDD #Book

## 표현 영역
표현 영역의 책임은 크게 다음과 같다.

> [!summary]+ 
> + 사용자가 시스템을 사용할 수 있는 (화면)흐름을 제공하고 제어한다.
> + 사용자의 요청을 알맞은 응용 서비스에 전달하고 결과를 사용자에게 제공한다.
> + 사용자의 세션을 관리한다.

## 값 검증
값 검증은 표현 영역과 응용 서비스 두 곳에서 모두 수행할 수 있다.

> [!note]+ 
> + 표현 영역: 필수 값, 값의 형식, 범위 등을 검증한다.
> + 응용 서비스: 데이터의 존재 유무와 같은 논리적 오류를 검증한다.

## 권한 검사
개발할 시스템마다 권한의 복잡도가 달라진다. 보안 프레임워크에 대한 이해가 부족하면 프레임워크를 무턱대고 도입하는 것보다 개발할 시스템에 맞는 권한 검사 기능을 구현하는 것이 시스템 유지보수에 유리할 수 있다.

권한 검사는 다음의 영역에서 수행할 수 있다.

### 1. 표현 영역
- 인증된 사용자 여부 검사
- 접근 제어를 하기에 좋은 위치가 **서블릿 필터**이다.

### 2. 응용 서비스 영역
- URL 만으로 접근 제어를 할 수 없는 경우 응용 서비스의 메서드 단위로 권한 검사를 수행해야 한다.
- 스프링 시큐리티는 [[AOP]]를 활용해서 권한 검사를 수행할 수 있다.

> [!example]+ 
> ```java
> public class BlockMemberService {
> 	private MemberRepository memberRepository;
> 
> 	@PreAuthorize("hasRole('ADMIN')")
> 	public void block(String memberId) {
> 		Member member = memberRepository.findById(memberId);
> 		if (member == null) throw new NoMemberException();
> 		member.block();
> 		...
> 	}
> }
> ```

### 3. 도메인 영역
- 도메인 단위로 권한 검사를 해야 하는 경우는 다소 구현이 복잡해진다. 

> [!example]+ 
> 예를 들어, 게시글 삭제는 본인 또는 관리자 역할을 가진 사용자만 할 수 있다고 해보자. 이 경우 게시글 작성자가 본인인지 확인하려면 게시글 애그리거트를 먼저 로딩해야한다. 즉, 응용 서비스의 메서드 수준에서 권한 검사를 할 수 없기 때문에 직접 권한 검사 로직을 구현해야 한다.

## 조회 전용 기능과 응용 서비스
서비스에서 수행하는 추가적인 로직이 없고 조회 전용이라 트랜잭션이 필요하지 않을 경우에는 표현 영역에서 바로 조회 전용 기능을 사용해도 된다.

> [!tip]+ 
> 응용 서비스가 사용자 요청 기능을 실행하는데 별다른 기여를 하지 못한다면 굳이 서비스를 만들지 않아도 된다.
> 
> 음..난 모르겠다. 난 만드는게 더 나은거같은데..